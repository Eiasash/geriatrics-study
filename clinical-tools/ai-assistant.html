<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>×¢×•×–×¨ ×§×œ×™× ×™ AI - Geriatrics Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="mobile-fallback.css">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Heebo', sans-serif; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
        .gradient-bg { background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #1e3a5f 100%); }
        .glass-card { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); }
        .ai-glow { box-shadow: 0 0 30px rgba(59, 130, 246, 0.3); }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.1); }
        }
        .typing-indicator span {
            animation: typing 1.4s infinite;
            animation-fill-mode: both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .chat-message { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto p-4 max-w-6xl">
        <!-- Header -->
        <header class="glass-card rounded-2xl p-6 mb-6 shadow-xl">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                        <span class="text-3xl">ğŸ¤–</span>
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">×¢×•×–×¨ ×§×œ×™× ×™ AI</h1>
                        <p class="text-gray-600">××™× ×˜×’×¨×¦×™×” ×¢× ×× ×•×¢×™ AI ××•×‘×™×œ×™× ×œ×ª××™×›×” ×‘×”×—×œ×˜×•×ª ×§×œ×™× ×™×•×ª</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <span class="pulse-dot inline-block w-3 h-3 bg-green-500 rounded-full"></span>
                    <span class="text-sm text-gray-600">××—×•×‘×¨</span>
                </div>
            </div>
        </header>

        <!-- AI Service Selection -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <button onclick="selectAI('openevidence')" id="btn-openevidence" class="ai-btn glass-card p-4 rounded-xl hover:shadow-lg transition-all border-2 border-transparent hover:border-blue-400" aria-label="×‘×—×¨ OpenEvidence ×œ××—×§×¨ ××‘×•×¡×¡ ×¨××™×•×ª">
                <div class="text-3xl mb-2" aria-hidden="true">ğŸ”¬</div>
                <div class="font-semibold text-gray-800">OpenEvidence</div>
                <div class="text-xs text-gray-500">××—×§×¨ ××‘×•×¡×¡ ×¨××™×•×ª</div>
            </button>
            <button onclick="selectAI('chatgpt')" id="btn-chatgpt" class="ai-btn glass-card p-4 rounded-xl hover:shadow-lg transition-all border-2 border-transparent hover:border-green-400" aria-label="×‘×—×¨ ChatGPT GPT-4">
                <div class="text-3xl mb-2" aria-hidden="true">ğŸ’š</div>
                <div class="font-semibold text-gray-800">ChatGPT</div>
                <div class="text-xs text-gray-500">OpenAI GPT-4</div>
            </button>
            <button onclick="selectAI('claude')" id="btn-claude" class="ai-btn glass-card p-4 rounded-xl hover:shadow-lg transition-all border-2 border-transparent hover:border-orange-400" aria-label="×‘×—×¨ Claude ××‘×™×ª Anthropic">
                <div class="text-3xl mb-2" aria-hidden="true">ğŸ§¡</div>
                <div class="font-semibold text-gray-800">Claude</div>
                <div class="text-xs text-gray-500">Anthropic AI</div>
            </button>
            <button onclick="selectAI('perplexity')" id="btn-perplexity" class="ai-btn glass-card p-4 rounded-xl hover:shadow-lg transition-all border-2 border-transparent hover:border-purple-400" aria-label="×‘×—×¨ Perplexity ×œ×—×™×¤×•×© AI">
                <div class="text-3xl mb-2" aria-hidden="true">ğŸ”®</div>
                <div class="font-semibold text-gray-800">Perplexity</div>
                <div class="text-xs text-gray-500">×—×™×¤×•×© AI</div>
            </button>
        </div>

        <!-- Main Content Area -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Chat/Query Section -->
            <div class="lg:col-span-2">
                <div class="glass-card rounded-2xl shadow-xl overflow-hidden ai-glow">
                    <!-- Chat Header -->
                    <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl" id="selected-ai-icon">ğŸ”¬</span>
                            <div>
                                <h2 class="font-semibold" id="selected-ai-name">OpenEvidence AI</h2>
                                <p class="text-sm text-blue-200" id="selected-ai-desc">××—×§×¨ ×¨×¤×•××™ ××‘×•×¡×¡ ×¨××™×•×ª</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div id="chat-container" class="h-96 overflow-y-auto p-4 space-y-4 bg-gray-50" role="log" aria-live="polite" aria-label="×”×•×“×¢×•×ª ×¦'××˜">
                        <div class="chat-message flex gap-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                                ğŸ¤–
                            </div>
                            <div class="bg-white p-4 rounded-2xl rounded-tr-none shadow-sm max-w-md">
                                <p class="text-gray-700">×©×œ×•×! ×× ×™ ×”×¢×•×–×¨ ×”×§×œ×™× ×™ ×©×œ×š. ×× ×™ ×™×›×•×œ ×œ×¢×–×•×¨ ×œ×š ×¢×:</p>
                                <ul class="mt-2 text-sm text-gray-600 space-y-1">
                                    <li>â€¢ ×©××œ×•×ª ×§×œ×™× ×™×•×ª ×’×¨×™××˜×¨×™×•×ª</li>
                                    <li>â€¢ ××‘×—× ×” ××‘×“×œ×ª</li>
                                    <li>â€¢ ×”××œ×¦×•×ª ×˜×™×¤×•×œ ××‘×•×¡×¡×•×ª ×¨××™×•×ª</li>
                                    <li>â€¢ ×—×™×¤×•×© ××××¨×™× ×•××—×§×¨×™×</li>
                                </ul>
                                <p class="mt-2 text-gray-700">×‘×—×¨ ×× ×•×¢ AI ×œ××¢×œ×” ×•×”×ª×—×œ ×œ×©××•×œ!</p>
                            </div>
                        </div>
                    </div>

                    <!-- Input Area -->
                    <div class="p-4 bg-white border-t">
                        <div class="flex gap-3">
                            <label for="user-input" class="sr-only">×”×§×œ×“ ×©××œ×” ×§×œ×™× ×™×ª</label>
                            <textarea id="user-input" placeholder="×”×§×œ×“ ×©××œ×” ×§×œ×™× ×™×ª..."
                                class="flex-1 p-3 border rounded-xl resize-none focus:ring-2 focus:ring-blue-400 focus:outline-none"
                                rows="2" onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault();sendQuery()}" aria-label="×”×§×œ×“ ×©××œ×” ×§×œ×™× ×™×ª"></textarea>
                            <button onclick="sendQuery()" class="px-6 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all font-medium" aria-label="×©×œ×— ×©××œ×”">
                                ×©×œ×—
                            </button>
                        </div>
                        <div class="flex flex-wrap gap-2 mt-3">
                            <button onclick="useTemplate('delirium')" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700">×“×œ×™×¨×™×•× ×‘×§×©×™×©</button>
                            <button onclick="useTemplate('falls')" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700">×”×¢×¨×›×ª × ×¤×™×œ×•×ª</button>
                            <button onclick="useTemplate('polypharmacy')" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700">×¤×•×œ×™×¤×¨××¦×™×”</button>
                            <button onclick="useTemplate('dementia')" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700">×“×× ×¦×™×”</button>
                            <button onclick="useTemplate('frailty')" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700">×©×‘×¨×™×¨×™×•×ª</button>
                            <button onclick="useTemplate('anticoag')" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700">× ×•×’×“×™ ×§×¨×™×©×”</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Tools Sidebar -->
            <div class="space-y-4">
                <!-- Differential Diagnosis -->
                <div class="glass-card rounded-xl p-4 shadow-lg">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <span class="text-xl">ğŸ”</span>
                        ××‘×—× ×” ××‘×“×œ×ª AI
                    </h3>
                    <label for="symptoms-input" class="sr-only">×”×§×œ×“ ×ª×¡××™× ×™×</label>
                    <textarea id="symptoms-input" placeholder="×”×§×œ×“ ×ª×¡××™× ×™× (××•×¤×¨×“×™× ×‘×¤×¡×™×§×™×)..."
                        class="w-full p-3 border rounded-lg text-sm mb-3" rows="3" aria-label="×”×§×œ×“ ×ª×¡××™× ×™× ××•×¤×¨×“×™× ×‘×¤×¡×™×§×™×"></textarea>
                    <button onclick="generateDifferential()" class="w-full py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium" aria-label="×¦×•×¨ ××‘×—× ×” ××‘×“×œ×ª ××”×ª×¡××™× ×™×">
                        ×¦×•×¨ ××‘×—× ×” ××‘×“×œ×ª
                    </button>
                </div>

                <!-- Drug Interactions -->
                <div class="glass-card rounded-xl p-4 shadow-lg">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <span class="text-xl">ğŸ’Š</span>
                        ×‘×“×™×§×ª ××™× ×˜×¨××§×¦×™×•×ª
                    </h3>
                    <label for="drugs-input" class="sr-only">×”×§×œ×“ ×ª×¨×•×¤×•×ª</label>
                    <textarea id="drugs-input" placeholder="×”×§×œ×“ ×ª×¨×•×¤×•×ª (××•×¤×¨×“×•×ª ×‘×¤×¡×™×§×™×)..."
                        class="w-full p-3 border rounded-lg text-sm mb-3" rows="3" aria-label="×”×§×œ×“ ×ª×¨×•×¤×•×ª ××•×¤×¨×“×•×ª ×‘×¤×¡×™×§×™×"></textarea>
                    <button onclick="checkInteractions()" class="w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium" aria-label="×‘×“×•×§ ××™× ×˜×¨××§×¦×™×•×ª ×‘×™×Ÿ ×”×ª×¨×•×¤×•×ª">
                        ×‘×“×•×§ ××™× ×˜×¨××§×¦×™×•×ª
                    </button>
                </div>

                <!-- Geriatric Syndromes Quick Check -->
                <div class="glass-card rounded-xl p-4 shadow-lg">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <span class="text-xl">ğŸ‘´</span>
                        ×ª×¡××•× ×•×ª ×’×¨×™××˜×¨×™×•×ª
                    </h3>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="queryGeriatric('delirium')" class="p-2 text-sm bg-yellow-100 hover:bg-yellow-200 rounded-lg text-yellow-800">×“×œ×™×¨×™×•×</button>
                        <button onclick="queryGeriatric('dementia')" class="p-2 text-sm bg-blue-100 hover:bg-blue-200 rounded-lg text-blue-800">×“×× ×¦×™×”</button>
                        <button onclick="queryGeriatric('depression')" class="p-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-800">×“×™×›××•×Ÿ</button>
                        <button onclick="queryGeriatric('incontinence')" class="p-2 text-sm bg-purple-100 hover:bg-purple-200 rounded-lg text-purple-800">××™-×©×œ×™×˜×”</button>
                        <button onclick="queryGeriatric('malnutrition')" class="p-2 text-sm bg-orange-100 hover:bg-orange-200 rounded-lg text-orange-800">×ª×ª-×ª×–×•× ×”</button>
                        <button onclick="queryGeriatric('falls')" class="p-2 text-sm bg-red-100 hover:bg-red-200 rounded-lg text-red-800">× ×¤×™×œ×•×ª</button>
                    </div>
                </div>

                <!-- Evidence Links -->
                <div class="glass-card rounded-xl p-4 shadow-lg">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <span class="text-xl">ğŸ“š</span>
                        ×§×™×©×•×¨×™× ××”×™×¨×™×
                    </h3>
                    <div class="space-y-2">
                        <a href="https://www.openevidence.com" target="_blank" rel="noopener noreferrer" class="block p-2 bg-blue-50 hover:bg-blue-100 rounded-lg text-blue-700 text-sm" aria-label="OpenEvidence AI - × ×¤×ª×— ×‘×—×œ×•×Ÿ ×—×“×©">
                            OpenEvidence AI â†’
                        </a>
                        <a href="https://www.uptodate.com/contents/search" target="_blank" rel="noopener noreferrer" class="block p-2 bg-green-50 hover:bg-green-100 rounded-lg text-green-700 text-sm" aria-label="UpToDate - × ×¤×ª×— ×‘×—×œ×•×Ÿ ×—×“×©">
                            UpToDate â†’
                        </a>
                        <a href="https://pubmed.ncbi.nlm.nih.gov/?term=geriatric" target="_blank" rel="noopener noreferrer" class="block p-2 bg-gray-50 hover:bg-gray-100 rounded-lg text-gray-700 text-sm" aria-label="PubMed Geriatrics - × ×¤×ª×— ×‘×—×œ×•×Ÿ ×—×“×©">
                            PubMed Geriatrics â†’
                        </a>
                        <a href="https://www.perplexity.ai" target="_blank" rel="noopener noreferrer" class="block p-2 bg-purple-50 hover:bg-purple-100 rounded-lg text-purple-700 text-sm" aria-label="Perplexity AI - × ×¤×ª×— ×‘×—×œ×•×Ÿ ×—×“×©">
                            Perplexity AI â†’
                        </a>
                        <a href="https://www.drugs.com/drug_interactions.html" target="_blank" rel="noopener noreferrer" class="block p-2 bg-red-50 hover:bg-red-100 rounded-lg text-red-700 text-sm" aria-label="Drugs.com ××™× ×˜×¨××§×¦×™×•×ª - × ×¤×ª×— ×‘×—×œ×•×Ÿ ×—×“×©">
                            Drugs.com Interactions â†’
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clinical Guidelines Section -->
        <div class="glass-card rounded-2xl p-6 mt-6 shadow-xl">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ“‹</span>
                ×”× ×—×™×•×ª ×§×œ×™× ×™×•×ª ×¢× AI
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="searchGuideline('AGS Beers Criteria')" class="p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl hover:shadow-md transition-all">
                    <div class="text-2xl mb-2">ğŸº</div>
                    <div class="font-semibold text-gray-800">AGS Beers</div>
                    <div class="text-xs text-gray-500">×ª×¨×•×¤×•×ª ×œ× ××ª××™××•×ª</div>
                </button>
                <button onclick="searchGuideline('STOPP START criteria elderly')" class="p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-xl hover:shadow-md transition-all">
                    <div class="text-2xl mb-2">ğŸ›‘</div>
                    <div class="font-semibold text-gray-800">STOPP/START</div>
                    <div class="text-xs text-gray-500">×§×¨×™×˜×¨×™×•× ×™× ×œ×ª×¨×•×¤×•×ª</div>
                </button>
                <button onclick="searchGuideline('frailty assessment CGA')" class="p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl hover:shadow-md transition-all">
                    <div class="text-2xl mb-2">ğŸ¥</div>
                    <div class="font-semibold text-gray-800">CGA</div>
                    <div class="text-xs text-gray-500">×”×¢×¨×›×” ×’×¨×™××˜×¨×™×ª ××§×™×¤×”</div>
                </button>
                <button onclick="searchGuideline('delirium prevention hospital elderly')" class="p-4 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl hover:shadow-md transition-all">
                    <div class="text-2xl mb-2">âš ï¸</div>
                    <div class="font-semibold text-gray-800">HELP Protocol</div>
                    <div class="text-xs text-gray-500">×× ×™×¢×ª ×“×œ×™×¨×™×•×</div>
                </button>
            </div>
        </div>

        <!-- Chat History -->
        <div class="glass-card rounded-2xl p-6 mt-6 shadow-xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <span class="text-2xl">ğŸ’¾</span>
                    ×”×™×¡×˜×•×¨×™×™×ª ×©××™×œ×ª×•×ª
                </h2>
                <button onclick="clearHistory()" class="text-sm text-red-600 hover:text-red-800">× ×§×” ×”×™×¡×˜×•×¨×™×”</button>
            </div>
            <div id="history-container" class="space-y-2 max-h-48 overflow-y-auto">
                <p class="text-gray-500 text-sm">×¢×“×™×™×Ÿ ××™×Ÿ ×©××™×œ×ª×•×ª ×©××•×¨×•×ª</p>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-white/70 mt-8 pb-4">
            <p class="text-sm">×”×¢×•×–×¨ ×”×§×œ×™× ×™ AI - ×¤×œ×˜×¤×•×¨××ª ×’×¨×™××˜×¨×™×” ××ª×§×“××ª</p>
            <a href="../index.html" class="text-white hover:underline text-sm">×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</a>
        </footer>
    </div>

    <script>
        let selectedAI = 'openevidence';
        let chatHistory = JSON.parse(localStorage.getItem('aiChatHistory') || '[]');

        const aiServices = {
            openevidence: {
                name: 'OpenEvidence AI',
                icon: 'ğŸ”¬',
                desc: '××—×§×¨ ×¨×¤×•××™ ××‘×•×¡×¡ ×¨××™×•×ª',
                url: 'https://www.openevidence.com',
                copyQuery: true, // Flag to copy query to clipboard
                color: 'blue'
            },
            chatgpt: {
                name: 'ChatGPT (GPT-4)',
                icon: 'ğŸ’š',
                desc: 'OpenAI - ×©××œ×•×ª ×§×œ×™× ×™×•×ª ××•×¨×›×‘×•×ª',
                url: 'https://chat.openai.com',
                copyQuery: true,
                color: 'green'
            },
            claude: {
                name: 'Claude AI',
                icon: 'ğŸ§¡',
                desc: 'Anthropic - × ×™×ª×•×— ××¢××™×§',
                url: 'https://claude.ai',
                copyQuery: true,
                color: 'orange'
            },
            perplexity: {
                name: 'Perplexity AI',
                icon: 'ğŸ”®',
                desc: '×—×™×¤×•×© AI ×¢× ××§×•×¨×•×ª',
                url: 'https://www.perplexity.ai/search?q=',
                copyQuery: false, // Perplexity supports deep linking
                color: 'purple'
            }
        };

        const templates = {
            delirium: '××”×• ×”×¤×¨×•×˜×•×§×•×œ ×”××•××œ×¥ ×œ×”×¢×¨×›×” ×•×˜×™×¤×•×œ ×‘×“×œ×™×¨×™×•× ×‘×—×•×œ×” ×’×¨×™××˜×¨×™ ×××•×©×¤×–? ×›×•×œ×œ ××‘×—× ×” ××‘×“×œ×ª, ×‘×™×¨×•×¨ ×•×˜×™×¤×•×œ.',
            falls: '××”×™ ×”×’×™×©×” ×”××§×™×¤×” ×œ×”×¢×¨×›×ª ××˜×•×¤×œ ×’×¨×™××˜×¨×™ ×œ××—×¨ × ×¤×™×œ×”? ×›×•×œ×œ ×’×•×¨××™ ×¡×™×›×•×Ÿ, ×‘×™×¨×•×¨ ×•×× ×™×¢×”.',
            polypharmacy: '×›×™×¦×“ ×œ×‘×¦×¢ deprescribing ×‘×˜×•×— ×‘×—×•×œ×” ×’×¨×™××˜×¨×™ ×¢× ×¤×•×œ×™×¤×¨××¦×™×”? ××”× ×”×§×¨×™×˜×¨×™×•× ×™× ×©×œ Beers ×•-STOPP/START?',
            dementia: '××”×™ ×”×’×™×©×” ×”××•××œ×¦×ª ×œ××‘×—×•×Ÿ ×•×˜×™×¤×•×œ ×‘×“×× ×¦×™×”? ×›×•×œ×œ ××‘×—× ×” ××‘×“×œ×ª ×‘×™×Ÿ ×¡×•×’×™ ×“×× ×¦×™×”.',
            frailty: '×›×™×¦×“ ×œ×”×¢×¨×™×š ×•×œ×˜×¤×œ ×‘×©×‘×¨×™×¨×™×•×ª (frailty) ×‘××˜×•×¤×œ ×’×¨×™××˜×¨×™? ××”× ×”×›×œ×™× ×”××•××œ×¦×™× ×œ×”×¢×¨×›×”?',
            anticoag: '××”×Ÿ ×”×”××œ×¦×•×ª ×œ× ×•×’×“×™ ×§×¨×™×©×” ×‘××˜×•×¤×œ ×’×¨×™××˜×¨×™ ×¢× ×¤×¨×¤×•×¨ ×¤×¨×•×–×“×•×¨×™×? ×›×™×¦×“ ×œ××–×Ÿ ×‘×™×Ÿ ×¡×™×›×•×Ÿ ×œ×“×™××•× ×œ×¡×™×›×•×Ÿ ×œ×©×‘×¥?'
        };

        function selectAI(ai) {
            selectedAI = ai;
            const service = aiServices[ai];

            // Update UI
            document.querySelectorAll('.ai-btn').forEach(btn => {
                btn.classList.remove('border-blue-400', 'border-green-400', 'border-orange-400', 'border-purple-400', 'ai-glow');
            });
            document.getElementById(`btn-${ai}`).classList.add(`border-${service.color}-400`, 'ai-glow');

            document.getElementById('selected-ai-icon').textContent = service.icon;
            document.getElementById('selected-ai-name').textContent = service.name;
            document.getElementById('selected-ai-desc').textContent = service.desc;
        }

        function sendQuery() {
            const input = document.getElementById('user-input');
            const query = input.value.trim();
            if (!query) return;

            // Add user message to chat
            addMessage(query, 'user');

            // Save to history
            saveToHistory(query, selectedAI);

            // Open AI service with query
            const service = aiServices[selectedAI];
            const encodedQuery = encodeURIComponent(`[Geriatric Medicine Question] ${query}`);
            
            // Handle services that need query copied to clipboard
            if (service.copyQuery) {
                navigator.clipboard.writeText(`[Geriatric Medicine Question] ${query}`).then(() => {
                    addMessage(`×”×©××œ×” ×”×•×¢×ª×§×” ×œ×œ×•×—. ${service.name} × ×¤×ª×— - ×”×“×‘×™×§×• ××ª ×”×©××œ×” ×©×.`, 'ai');
                }).catch(() => {
                    addMessage(`×”×©××™×œ×ª×” × ×©×œ×—×” ×œ-${service.name}. × ×¤×ª×— ×—×œ×•×Ÿ ×—×“×©.`, 'ai');
                });
                window.open(service.url, '_blank', 'noopener,noreferrer');
            } else {
                // Service supports deep linking
                window.open(service.url + encodedQuery, '_blank', 'noopener,noreferrer');
                setTimeout(() => {
                    addMessage(`×”×©××™×œ×ª×” × ×©×œ×—×” ×œ-${service.name}. × ×¤×ª×— ×—×œ×•×Ÿ ×—×“×© ×¢× ×”×ª×©×•×‘×”.`, 'ai');
                }, 500);
            }

            input.value = '';
        }

        function addMessage(text, type) {
            const container = document.getElementById('chat-container');
            const isUser = type === 'user';

            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message flex gap-3 ${isUser ? 'flex-row-reverse' : ''}`;
            messageDiv.innerHTML = `
                <div class="w-10 h-10 ${isUser ? 'bg-green-100' : 'bg-blue-100'} rounded-full flex items-center justify-center flex-shrink-0">
                    ${isUser ? 'ğŸ‘¤' : 'ğŸ¤–'}
                </div>
                <div class="${isUser ? 'bg-green-100' : 'bg-white'} p-4 rounded-2xl ${isUser ? 'rounded-tl-none' : 'rounded-tr-none'} shadow-sm max-w-md">
                    <p class="text-gray-700">${text}</p>
                </div>
            `;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function useTemplate(key) {
            document.getElementById('user-input').value = templates[key];
        }

        function generateDifferential() {
            const symptoms = document.getElementById('symptoms-input').value.trim();
            if (!symptoms) {
                alert('× × ×œ×”×–×™×Ÿ ×ª×¡××™× ×™×');
                return;
            }

            const query = `×¦×•×¨ ××‘×—× ×” ××‘×“×œ×ª ×’×¨×™××˜×¨×™×ª ×¢×‘×•×¨ ××˜×•×¤×œ ×¢× ×”×ª×¡××™× ×™× ×”×‘××™×: ${symptoms}. ×›×œ×•×œ ×¡×™×‘×•×ª ×©×›×™×—×•×ª, ×¤×—×•×ª ×©×›×™×—×•×ª, ×•×‘×™×¨×•×¨ ××•××œ×¥.`;
            document.getElementById('user-input').value = query;
            sendQuery();
        }

        function checkInteractions() {
            const drugs = document.getElementById('drugs-input').value.trim();
            if (!drugs) {
                alert('× × ×œ×”×–×™×Ÿ ×ª×¨×•×¤×•×ª');
                return;
            }

            // Open Drugs.com interaction checker
            const drugList = drugs.split(',').map(d => d.trim()).filter(d => d);
            if (drugList.length < 2) {
                alert('× × ×œ×”×–×™×Ÿ ×œ×¤×—×•×ª 2 ×ª×¨×•×¤×•×ª ×œ×‘×“×™×§×ª ××™× ×˜×¨××§×¦×™×•×ª');
                return;
            }

            // Also send to AI
            const query = `×‘×“×•×§ ××™× ×˜×¨××§×¦×™×•×ª ×‘×™×Ÿ ×”×ª×¨×•×¤×•×ª ×”×‘××•×ª ×‘××˜×•×¤×œ ×’×¨×™××˜×¨×™: ${drugs}. ×›×œ×•×œ ××™× ×˜×¨××§×¦×™×•×ª ××©××¢×•×ª×™×•×ª, ×”×ª×××•×ª ××™× ×•×Ÿ, ×•×”××œ×¦×•×ª.`;
            document.getElementById('user-input').value = query;

            // Open drugs.com
            window.open(`https://www.drugs.com/drug_interactions.html?drug_list=${drugList.join(',')}`, '_blank', 'noopener,noreferrer');

            sendQuery();
        }

        function queryGeriatric(syndrome) {
            const queries = {
                delirium: '×”×¢×¨×›×” ×•×˜×™×¤×•×œ ×‘×“×œ×™×¨×™×•× ×—×¨×™×£ ×‘××˜×•×¤×œ ×’×¨×™××˜×¨×™ ×××•×©×¤×– - ×¤×¨×•×˜×•×§×•×œ ××œ×',
                dementia: '××‘×—× ×” ××‘×“×œ×ª ×•×˜×™×¤×•×œ ×‘×“×× ×¦×™×” - Alzheimer vs Vascular vs Lewy Body vs FTD',
                depression: '×“×™×›××•×Ÿ ×‘×§×©×™×©×™× - ×”×¢×¨×›×”, ××‘×—× ×” ××‘×“×œ×ª ××“×× ×¦×™×”, ×•×˜×™×¤×•×œ',
                incontinence: '××™-×©×œ×™×˜×” ×¢×œ ×¡×•×’×¨×™× ×‘×§×©×™×©×™× - ×‘×™×¨×•×¨ ×•×˜×™×¤×•×œ',
                malnutrition: '×ª×ª-×ª×–×•× ×” ×‘×§×©×™×©×™× - ×”×¢×¨×›×”, ×’×•×¨××™ ×¡×™×›×•×Ÿ ×•×˜×™×¤×•×œ',
                falls: '×”×¢×¨×›×” ××§×™×¤×” ×©×œ × ×¤×™×œ×•×ª ×‘×§×©×™×©×™× - ×’×•×¨××™ ×¡×™×›×•×Ÿ ×•×× ×™×¢×”'
            };

            document.getElementById('user-input').value = queries[syndrome];
            sendQuery();
        }

        function searchGuideline(guideline) {
            const query = `×”× ×—×™×•×ª ×§×œ×™× ×™×•×ª ×¢×“×›× ×™×•×ª: ${guideline} - ×¡×™×›×•× ×”××œ×¦×•×ª ×¢×™×§×¨×™×•×ª`;
            document.getElementById('user-input').value = query;
            sendQuery();
        }

        function saveToHistory(query, ai) {
            chatHistory.unshift({
                query: query,
                ai: ai,
                timestamp: new Date().toISOString()
            });
            chatHistory = chatHistory.slice(0, 50); // Keep last 50
            localStorage.setItem('aiChatHistory', JSON.stringify(chatHistory));
            renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('history-container');
            if (chatHistory.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">×¢×“×™×™×Ÿ ××™×Ÿ ×©××™×œ×ª×•×ª ×©××•×¨×•×ª</p>';
                return;
            }

            container.innerHTML = chatHistory.slice(0, 10).map(item => {
                const service = aiServices[item.ai];
                const date = new Date(item.timestamp).toLocaleDateString('he-IL');
                return `
                    <div class="flex items-center gap-3 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer" onclick="reuseQuery('${item.query.replace(/'/g, "\\'")}')">
                        <span>${service.icon}</span>
                        <div class="flex-1 truncate text-sm text-gray-700">${item.query}</div>
                        <span class="text-xs text-gray-400">${date}</span>
                    </div>
                `;
            }).join('');
        }

        function reuseQuery(query) {
            document.getElementById('user-input').value = query;
        }

        function clearHistory() {
            if (confirm('×”×× ×œ××—×•×§ ××ª ×›×œ ×”×”×™×¡×˜×•×¨×™×”?')) {
                chatHistory = [];
                localStorage.removeItem('aiChatHistory');
                renderHistory();
            }
        }

        // Initialize
        selectAI('openevidence');
        renderHistory();
    </script>
</body>
</html>
